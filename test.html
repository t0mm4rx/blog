<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Test Animation</title>
    <style>
      body {
        padding: 0;
        margin: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    </style>
  </head>
  <body>

    <canvas width="100" height="100" id="anim"></canvas>

  </body>

  <script>

    var canvas = document.getElementById('anim')
    var ctx = canvas.getContext("2d")
    var speed = 0.5

    var timestamp = null
    var lastMouseX = null
    var lastMouseY = null

    var deltaV = 0

    var points = []
    for (var i = 0; i < 12; i++) {
      points.push({
        x: Math.random() * 100,
        y: Math.random() * 100,
        vx: Math.random() - 0.5,
        vy: Math.random() - 0.5
      })
    }

    setInterval(update, 1000 / 24)

    function draw() {
      ctx.fillStyle = "#CCC";
      ctx.fillStyle = "#FFF";
      ctx.fillRect(0,0,100,100);
      ctx.fillStyle = "rgb(23, 109, 164)";
      ctx.fillStyle = "rgba(23, 109, 164, .4)";

      for (var z = 0; z < 4; z++) {
        ctx.beginPath()
        ctx.moveTo(points[0].x, points[0].y);
        for (var i = z; i < z + 5; i++) {
          ctx.lineTo(points[i].x, points[i].y)
        }
        ctx.fill()
      }
    }

    function update() {
      for (var i = 0; i < points.length; i++) {

        points[i].vx += (Math.random() - .5) * .1
        points[i].vy += (Math.random() - .5) * .1

        if (points[i].x < 100 && points[i].x > 0)
          points[i].x += points[i].vx * speed + (deltaV / 200) * points[i].vx
        if (points[i].y < 100 && points[i].y > 0)
          points[i].y += points[i].vy * speed + (deltaV / 200) * points[i].vy
        if (points[i].y > 100) {
          points[i].y = 99
          points[i].vy = -points[i].vy
        }
        if (points[i].y < 0) {
          points[i].y = 1
          points[i].vy = -points[i].vy
        }
        if (points[i].x > 100) {
          points[i].x = 99
          points[i].vx = -points[i].vx
        }
        if (points[i].x < 0) {
          points[i].x = 1
          points[i].vx = -points[i].vx
        }
      }

      if (deltaV > .1) {
        deltaV -= 10
      } else {
        deltaV = 0
      }
      console.log(deltaV)
      draw()
    }

    document.body.addEventListener("mousemove", function(e) {
        if (timestamp === null) {
            timestamp = Date.now();
            lastMouseX = e.screenX;
            lastMouseY = e.screenY;
            return;
        }

        var now = Date.now();
        var dt =  now - timestamp;
        var dx = e.screenX - lastMouseX;
        var dy = e.screenY - lastMouseY;
        var mouseX = Math.round(dx / dt * 100);
        var mouseY = Math.round(dy / dt * 100);
        if (deltaV < 100)
          deltaV += Math.sqrt(Math.pow(mouseX, 2), Math.pow(mouseY, 2))

        deltaV = Math.min(100, deltaV)

        timestamp = now;
        lastMouseX = e.screenX;
        lastMouseY = e.screenY;
    });

  </script>

</html>
